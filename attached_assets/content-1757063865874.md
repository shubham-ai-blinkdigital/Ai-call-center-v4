hCaptcha

hCaptcha

Afrikaans

Albanian

Amharic

Arabic

Armenian

Azerbaijani

Basque

Belarusian

Bengali

Bulgarian

Bosnian

Burmese

Catalan

Cebuano

Chinese

Chinese Simplified

Chinese Traditional

Corsican

Croatian

Czech

Danish

Dutch

English

Esperanto

Estonian

Finnish

French

Frisian

Gaelic

Galacian

Georgian

German

Greek

Gujurati

Haitian

Hausa

Hawaiian

Hebrew

Hindi

Hmong

Hungarian

Icelandic

Igbo

Indonesian

Irish

Italian

Japanese

Javanese

Kannada

Kazakh

Khmer

Kinyarwanda

Kirghiz

Korean

Kurdish

Lao

Latin

Latvian

Lithuanian

Luxembourgish

Macedonian

Malagasy

Malay

Malayalam

Maltese

Maori

Marathi

Mongolian

Nepali

Norwegian

Nyanja

Oriya

Persian

Polish

Portuguese (Brazil)

Portuguese (Portugal)

Pashto

Punjabi

Romanian

Russian

Samoan

Shona

Sindhi

Sinhalese

Serbian

Slovak

Slovenian

Somali

Southern Sotho

Spanish

Sundanese

Swahili

Swedish

Tagalog

Tajik

Tamil

Tatar

Teluga

Thai

Turkish

Turkmen

Uyghur

Ukrainian

Urdu

Uzbek

Vietnamese

Welsh

Xhosa

Yiddish

Yoruba

Zulu

EN

[Visit hcaptcha.com to learn more about the service and its accessibility options.](https://www.hcaptcha.com/what-is-hcaptcha-about?ref=b.stripecdn.com&utm_campaign=5034f7f0-a742-48aa-89e2-062ece60f0d6&utm_medium=challenge&hl=en "Visit hcaptcha.com to learn more about the service and its accessibility options.")

Please try again. ⚠️

Verify

[Skip to content](https://docs.stripe.com/webhooks/signature#main-content)

Resolve webhook signature verification errors

[Create account](https://dashboard.stripe.com/register) or [Sign in](https://dashboard.stripe.com/login?redirect=https%3A%2F%2Fdocs.stripe.com%2Fwebhooks%2Fsignature)

[The Stripe Docs logo](https://docs.stripe.com/)

Search

`/`Ask AI

[Create account](https://dashboard.stripe.com/register)

[Sign in](https://dashboard.stripe.com/login?redirect=https%3A%2F%2Fdocs.stripe.com%2Fwebhooks%2Fsignature)

[Get started](https://docs.stripe.com/get-started)

[Payments](https://docs.stripe.com/payments)

[Revenue](https://docs.stripe.com/revenue)

[Platforms and marketplaces](https://docs.stripe.com/connect)

[Money management](https://docs.stripe.com/money-management)

[Developer resources](https://docs.stripe.com/development)

APIs & SDKs

Help

[Overview](https://docs.stripe.com/development)

Versioning

Changelog

[Upgrade your API version](https://docs.stripe.com/upgrades)

Upgrade your SDK version

Essentials

SDKs

API

Testing

Stripe CLI

Sample projects

Tools

Workbench

Developers Dashboard

Stripe Shell

[Stripe for Visual Studio Code](https://docs.stripe.com/stripe-vscode)

Features

Workflows

Event destinations

[Integrate with events](https://docs.stripe.com/event-destinations)

[Amazon EventBridge](https://docs.stripe.com/event-destinations/eventbridge)

[Webhook endpoint](https://docs.stripe.com/webhooks)

[Webhook builder](https://docs.stripe.com/webhooks/quickstart)

[Webhook versioning](https://docs.stripe.com/webhooks/versioning)

Resolve webhook signature verification errors

[Process undelivered events](https://docs.stripe.com/webhooks/process-undelivered-events)

[Stripe health alerts](https://docs.stripe.com/health-alerts) [File uploads](https://docs.stripe.com/file-upload)

AI solutions

Agent toolkit

[Model Context Protocol](https://docs.stripe.com/mcp)

Security and privacy

Security

[Stripebot web crawler](https://docs.stripe.com/stripebot-crawler)

Privacy

Extend Stripe

Build Stripe apps

Use apps from Stripe

Partners

Partner ecosystem

[Partner certification](https://docs.stripe.com/partners/training-and-certification)

United States

English (United States)

[Home](https://docs.stripe.com/ "Home")[Developer resources](https://docs.stripe.com/development "Developer resources")Event destinations[Webhook endpoint](https://docs.stripe.com/webhooks "Webhook endpoint")

# Resolve webhook signature verificationerrors

## Learn how to fix a common error when listening to webhook events.

Ask about this page

Copy for LLM

View as Markdown

When processing webhook events, we recommend securing your endpoint by [verifying](https://docs.stripe.com/webhooks#verify-official-libraries) that the event is coming from Stripe. To do so, use the `Stripe-Signature` header and call the `constructEvent()` function with three parameters:

- `requestBody`: the request body string sent by Stripe
- `signature`: the Stripe-Signature header in the request sent by Stripe
- `endpointSecret`: the secret associated with your endpoint

Select a language

Select a language

Ruby

Ruby

Python

PHP

Java

Node.js

Go

.NET

```CodeBlock-code

Stripe::Webhook.construct_event(request_body, signature, endpoint_secret)
```

This function might trigger a signature verification error.

```CodeBlock-code

Webhook signature verification failed. Err: No signatures found matching the expected signature for payload.

```

If you get this error, at least one of the three parameters you passed to the above function is incorrect. The following steps explain how to verify that each parameter is correctly set.

## Check the endpoint secret![](https://b.stripecdn.com/docs-statics-srv/assets/fcc3a1c24df6fcffface6110ca4963de.svg)

The most common error is using the wrong endpoint secret. If you’re using a webhook endpoint created in the [Dashboard](https://dashboard.stripe.com/test/webhooks), open the endpoint in the Dashboard and click the **Reveal secret** link near the top of the page to view the secret.

![Dashboard screenshot showing where to find the webhook secret key](https://b.stripecdn.com/docs-statics-srv/assets/dashboard-secret.ea91fb644ee376b25daee8438bc6a33c.png)

If you’re using the Stripe CLI, the secret is printed in the Terminal when you run the `stripe listen` command.

![cli screenshot showing where to find the webhook secret key](https://b.stripecdn.com/docs-statics-srv/assets/cli-secret.43855dd95672a6d396ef8cf2eeb9e8fa.png)

In both cases, the secret starts with a `whsec_` prefix, but the secret itself is different. Don’t verify signatures on events forwarded by the CLI using the secret from a Dashboard-managed endpoint, or the other way around.

Finally, print the `endpointSecret` used in your code, and make sure that it matches the one you found above.

## Check the request body![](https://b.stripecdn.com/docs-statics-srv/assets/fcc3a1c24df6fcffface6110ca4963de.svg)

The request body must be the body string that Stripe sends in UTF-8 encoding without any changes. When you print it as a string, it looks similar to this:

```CodeBlock-code

{
  "id": "evt_xxx",
  "object": "event",
  "data": {
      ...
  }
}

```

### Retrieve the raw request body![](https://b.stripecdn.com/docs-statics-srv/assets/fcc3a1c24df6fcffface6110ca4963de.svg)

Some frameworks might edit the request body by doing things like adding or removing whitespace, reordering the key-value pairs, converting the string to JSON, or changing the encoding. All of these cases lead to a failed signature verification.

The following is a non-exhaustive list of frameworks that might parse or mutate the data using common configurations, and some tips on how to get the raw request body.

| Framework | Retrieval method |
| --- | --- |
| stripe-node library with Express | Follow our [integration quickstart guide](https://docs.stripe.com/webhooks/quickstart?lang=node). |
| stripe-node library with Body Parser | Try solutions listed in [this GitHub issue](https://github.com/stripe/stripe-node/issues/341). |
| stripe-node library with Next.js [App Router](https://nextjs.org/docs/app/building-your-application/routing/route-handlers) | Take a look at this [working example](https://github.com/stripe/stripe-node/blob/master/examples/webhook-signing/nextjs/app/api/webhooks/route.ts). |
| stripe-node library with Next.js [Pages Router](https://nextjs.org/docs/pages/building-your-application/routing/api-routes) | Try disabling `bodyParser` and using `buffer(request)`, like in [this example](https://github.com/stripe/stripe-node/blob/master/examples/webhook-signing/nextjs/pages/api/webhooks.ts). |

### AWS API Gateway with Lambda function![](https://b.stripecdn.com/docs-statics-srv/assets/fcc3a1c24df6fcffface6110ca4963de.svg)

To retrieve the raw request body for the AWS API Gateway with Lambda function, in the API Gateway, set up a Body Mapping Template like this:

- Content-Type: `application/json`
- Template contents:

```CodeBlock-code

{
  "method": "$context.httpMethod",
  "body": $input.json('$'),
  "rawBody": "$util.escapeJavaScript($input.body).replaceAll("\\'", "'")",
  "headers": {
    #foreach($param in $input.params().header.keySet())
    "$param": "$util.escapeJavaScript($input.params().header.get($param))"
    #if($foreach.hasNext),#end
    #end
  }
}

```

Then, in the Lambda function, access the raw body with the event’s `rawBody` property and the headers with the event’s `headers` property.

## Check the signature![](https://b.stripecdn.com/docs-statics-srv/assets/fcc3a1c24df6fcffface6110ca4963de.svg)

Print the `signature` parameter, and confirm that it looks similar to this:

```CodeBlock-code

t=xxx,v1=yyy,v0=zzz

```

If not, check if you have an issue in your code when trying to extract the signature from the header.

Was this page helpful?

YesNo

- Need help? [Contact Support](https://support.stripe.com/).
- Join our [early access program](https://insiders.stripe.dev/).
- Check out our [changelog](https://docs.stripe.com/changelog).
- Questions? [Contact Sales](https://stripe.com/contact/sales).
- LLM? [Read llms.txt](https://docs.stripe.com/llms.txt).
- Powered by [Markdoc](https://markdoc.dev/)

Sign up for developer updates:

Sign upYou can unsubscribe at any time. Read our [privacy policy](https://stripe.com/privacy).

On this page

[Check the endpoint secret](https://docs.stripe.com/webhooks/signature#check-the-endpoint-secret "Check the endpoint secret")

[Check the request body](https://docs.stripe.com/webhooks/signature#check-the-request-body "Check the request body")

[Retrieve the raw request body](https://docs.stripe.com/webhooks/signature#retrieve-the-raw-request-body "Retrieve the raw request body")

[AWS API Gateway with Lambda function](https://docs.stripe.com/webhooks/signature#aws-api-gateway-with-lambda-function "AWS API Gateway with Lambda function")

[Check the signature](https://docs.stripe.com/webhooks/signature#check-the-signature "Check the signature")

Stripe Shell

Test mode

API Explorer

```CodeBlock

Welcome to the Stripe Shell!

Stripe Shell is a browser-based shell with the Stripe CLI pre-installed. Log in to your
Stripe account and press Control + Backtick (`) on your keyboard to start managing your Stripe
resources in test mode.

- View supported Stripe commands:

stripe help ▶️
- Find webhook events:

stripe trigger ▶️ [event]
- Listen for webhook events:

stripe listen ▶
- Call Stripe APIs: stripe [api resource] [operation] (e.g.,

stripe customers list ▶️)

```

The Stripe Shell is best experienced on desktop.

```
$
```

StripeM-Inner
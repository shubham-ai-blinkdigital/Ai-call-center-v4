#!/bin/bash # Database sync script - Development to Production echo "üîÑ Starting database sync from Development to Production..." # Define connection URLs DEVELOPMENT_URL="postgresql://neondb_owner:npg_DMC9xle1yBEc@ep-round-wave-aechlh6x.c-2.us-east-2.aws.neon.tech/neondb?sslmode=require" PRODUCTION_URL="postgresql://neondb_owner:npg_Qw2eK7cRdbfH@ep-winter-queen-aepj6owd.c-2.us-east-2.aws.neon.tech/neondb?sslmode=require" # Step 1: Create backup of production database echo "üì¶ Creating backup of production database..." pg_dump "$PRODUCTION_URL" > production_backup_$(date +%Y%m%d_%H%M%S).sql if [ $? -eq 0 ]; then echo "‚úÖ Production backup created successfully" else echo "‚ùå Failed to create production backup" exit 1 fi # Step 2: Export development database echo "üì§ Exporting development database..." pg_dump "$DEVELOPMENT_URL" > development_export.sql if [ $? -eq 0 ]; then echo "‚úÖ Development database exported successfully" else echo "‚ùå Failed to export development database" exit 1 fi # Step 3: Clean production database (drop all tables) echo "üßπ Cleaning production database..." psql "$PRODUCTION_URL" -c "DROP SCHEMA public CASCADE; CREATE SCHEMA public; GRANT ALL ON SCHEMA public TO neondb_owner; GRANT ALL ON SCHEMA public TO public;" if [ $? -eq 0 ]; then echo "‚úÖ Production database cleaned successfully" else echo "‚ùå Failed to clean production database" exit 1 fi # Step 4: Import development data to production echo "üì• Importing development data to production..." psql "$PRODUCTION_URL" < development_export.sql if [ $? -eq 0 ]; then echo "‚úÖ Development data imported to production successfully" else echo "‚ùå Failed to import development data to production" exit 1 fi # Step 5: Verify the sync echo "üîç Verifying database sync..." echo "Development database tables:" psql "$DEVELOPMENT_URL" -c "\dt" echo "" echo "Production database tables:" psql "$PRODUCTION_URL" -c "\dt" echo "" echo "üéâ Database sync completed successfully!" echo "üìÅ Production backup saved as: production_backup_$(date +%Y%m%d_%H%M%S).sql" echo 